<?php

class Maco_PGrid_Source_Array implements Maco_PGrid_Source_Interface
{
	/**
	 * Raw array data
	 *
	 * @array mixed
	 */
	protected $_data = array();

	/**
	 *Gets a unique record as a associative array
	 * @param $table
	 * @param $condition
	 */
	public function getRecord ($index)
	{
		if(!is_int($index))
		{
			throw new Maco_PGrid_Source_Exception('Index ' . $index . ' is not of type int', 500);
		}

		if($index < 0 || $index > $this->getTotalRecords())
		{
			throw new Maco_PGrid_Source_Exception('Index ' . $index . ' is not in the range of data', 500);
		}

		return $this->_data[$index];
	}

	/**
	 * Should return the database server name or source name
	 *
	 * Ex: mysql, pgsql, array, xml
	 */
	public function getSourceName ()
	{
		return 'array';
	}


	/**
	 *Runs the query and returns the result as a associative array
	 */
	public function execute ()
	{

	}

	/**
	 * Return the total of records
	 */
	public function getTotalRecords ()
	{
		return count($this->_data);
	}

	/**
	 *
	 * Build the order part from the query.
	 *
	 * The first arg is the field to be ordered and the $order
	 * arg is the correspondent order (ASC|DESC)
	 *
	 * If the $reset is set to true, all previous order should be removed
	 *
	 * @param string $field
	 * @param string $order
	 * @param bool $reset
	 */
	public function buildQueryOrder ($field, $order, $reset = false)
	{}


	/**
	 * Build the query limit clause
	 * @param $start
	 * @param $offset
	 */
	public function buildQueryLimit ($start, $offset)
	{}

	/**
	 * returns the selected order
	 * that was defined by the user in the query entered
	 * and not the one generated by the system
	 *
	 *If empty a empty array must be returned.
	 *
	 *Else the array must be like this:
	 *
	 *Array
	 * (
	 * [0] => field
	 * [1] => ORDER (ASC|DESC)
	 * )
	 *
	 *
	 * @return array
	 */
	public function getSelectOrder ()
	{}

	/**
	 *
	 *Perform a sqlexp
	 *
	 *$value =  array ('functions' => array ('AVG'), 'value' => 'Population' );
	 *
	 *Should be converted to
	 *SELECT AVG(Population) FROM *
	 *
	 *$value =  array ('functions' => array ('SUM','AVG'), 'value' => 'Population' );
	 *
	 *Should be converted to
	 *SELECT SUM(AVG(Population)) FROM *
	 *
	 * @param array $value
	 */
	public function getSqlExp (array $value, $where = array())
	{}

	/**
	 * Removes any order in que query
	 */
	public function resetOrder()
	{}

	/**
	 * Array of records
	 *
	 * @param array $data
	 * @param array $fields
	 */
	public function setData($data, $fields)
	{
		if(!is_array($data))
		{
			throw new Maco_PGrid_Source_Exception('For this kind of Source the data must be of type array', 500);
		}

		$this->_data = $data;
	}
}
