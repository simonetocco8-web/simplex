<?php

/**
 *
 * LICENSE
 *
 * This source file is subject to the new BSD license
 * It is  available through the world-wide-web at this URL:
 * http://www.petala-azul.com/bsd.txt
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to geral@petala-azul.com so we can send you a copy immediately.
 *
 * @package    Maco_PGrid
 */


interface Maco_PGrid_Source_Interface
{
	/**
	 *Gets a unique record as a associative array
	 * @param $table
	 * @param $condition
	 */
	public function getRecord ($index);

	/**
	 * Should return the database server name or source name
	 *
	 * Ex: mysql, pgsql, array, xml
	 */
	public function getSourceName ();


	/**
	 *Runs the query and returns the result as a associative array
	 */
	public function execute ();

	/**
	 * Return the total of records
	 */
	public function getTotalRecords ();

	/**
	 *
	 * Build the order part from the query.
	 *
	 * The first arg is the field to be ordered and the $order
	 * arg is the correspondent order (ASC|DESC)
	 *
	 * If the $reset is set to true, all previous order should be removed
	 *
	 * @param string $field
	 * @param string $order
	 * @param bool $reset
	 */
	public function buildQueryOrder ($field, $order, $reset = false);


	/**
	 * Build the query limit clause
	 * @param $start
	 * @param $offset
	 */
	public function buildQueryLimit ($start, $offset);

	/**
	 * returns the selected order
	 * that was defined by the user in the query entered
	 * and not the one generated by the system
	 *
	 *If empty a empty array must be returned.
	 *
	 *Else the array must be like this:
	 *
	 *Array
	 * (
	 * [0] => field
	 * [1] => ORDER (ASC|DESC)
	 * )
	 *
	 *
	 * @return array
	 */
	public function getSelectOrder ();

	/**
	 *
	 *Perform a sqlexp
	 *
	 *$value =  array ('functions' => array ('AVG'), 'value' => 'Population' );
	 *
	 *Should be converted to
	 *SELECT AVG(Population) FROM *
	 *
	 *$value =  array ('functions' => array ('SUM','AVG'), 'value' => 'Population' );
	 *
	 *Should be converted to
	 *SELECT SUM(AVG(Population)) FROM *
	 *
	 * @param array $value
	 */
	public function getSqlExp (array $value, $where = array());

	/**
	 * Removes any order in que query
	 */
	public function resetOrder();

	/**
	 * Sets the data source
	 *
	 * @param mixed $data
	 */
	public function setData($data, $fields);
}